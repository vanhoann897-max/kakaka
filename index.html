<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <title>Usagi ƒÉn con m·∫π m√†y</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Varela+Round&display=swap');
        body { margin: 0; overflow: hidden; background: #fdfcf0; font-family: 'Varela Round', sans-serif; cursor: none; }
        #game-container { position: relative; width: 100vw; height: 100vh; background: linear-gradient(to bottom, #e0f7fa, #fff9c4); }
        #ui-layer { position: absolute; top: 20px; left: 20px; z-index: 10; pointer-events: none; }
        .score-box { background: rgba(255,255,255,0.8); padding: 10px 20px; border-radius: 15px; border: 3px solid #ff8fa3; box-shadow: 4px 4px 0px rgba(0,0,0,0.1); }
        #overlay { position: absolute; inset: 0; background: rgba(255,255,255,0.85); display: flex; flex-direction: column; justify-content: center; align-items: center; z-index: 100; cursor: default; }
        .menu-content { background: white; padding: 40px; border-radius: 40px; border: 5px solid #ff8fa3; text-align: center; box-shadow: 0 10px 0 #ff5c7c; }
        .play-button { background: #ff8fa3; color: white; border: none; padding: 15px 60px; font-size: 28px; border-radius: 50px; cursor: pointer; font-family: inherit; font-weight: bold; box-shadow: 0 5px 0 #ff5c7c; }
        .hidden { display: none !important; }
        /* Th√™m th√¥ng b√°o n·∫øu ·∫£nh l·ªói */
        #error-msg { position: absolute; bottom: 10px; left: 10px; color: red; background: white; padding: 5px; display: none; }
    </style>
</head>
<body>

<div id="game-container">
    <canvas id="gameCanvas"></canvas>
    
    <div id="ui-layer">
        <div class="score-box">
            <div style="font-size: 24px; color: #ff6b6b;">ƒêi·ªÉm: <span id="score">0</span></div>
            <div style="font-size: 14px; color: #888;">K·ª∑ l·ª•c: <span id="high-score">0</span></div>
        </div>
    </div>

    <div id="overlay">
        <div class="menu-content">
            <img src="usagi1.png" style="width: 100px; height: 100px; border-radius: 50%; border: 3px solid #ff8fa3; margin-bottom: 10px;">
            <h1 style="color: #ff8fa3; font-size: 30px; margin: 10px 0;">USAGI ƒê√ìI B·ª§NG! üê∞</h1>
            <p>Di chu·ªôt ƒë·ªÉ ƒÉn ƒë·ªì ƒÉn ngon nh√©!</p>
            <button class="play-button" id="start-btn">CH∆†I NGAY</button>
        </div>
    </div>
    <div id="error-msg">Kh√¥ng t√¨m th·∫•y ·∫£nh! H√£y ki·ªÉm tra t√™n file: usagi1.png v√† usagi.jpg</div>
</div>

<script>
    const canvas = document.getElementById('gameCanvas');
    const ctx = canvas.getContext('2d');
    const audioCtx = new (window.AudioContext || window.webkitAudioContext)();

    // --- C·∫§U H√åNH ·∫¢NH ---
    const imgNormal = new Image();
    imgNormal.src = 'usagi1.png'; // ƒê√£ s·ª≠a th√†nh .png
    imgNormal.onerror = () => document.getElementById('error-msg').style.display = 'block';

    const imgEating = new Image();
    imgEating.src = 'usagi.jpg';  // ƒê√£ s·ª≠a th√†nh .jpg
    imgEating.onerror = () => document.getElementById('error-msg').style.display = 'block';

    let width, height, score = 0, gameActive = false;
    let items = [], frame = 0, speed = 4;
    let isEatingTimer = 0; 
    const player = { x: 0, y: 0, size: 90 }; // TƒÉng size l√™n 90 cho r√µ

    function playSound(freq, duration) {
        if (audioCtx.state === 'suspended') audioCtx.resume();
        const osc = audioCtx.createOscillator();
        const g = audioCtx.createGain();
        osc.frequency.setValueAtTime(freq, audioCtx.currentTime);
        g.gain.setValueAtTime(0.1, audioCtx.currentTime);
        g.gain.exponentialRampToValueAtTime(0.0001, audioCtx.currentTime + duration);
        osc.connect(g); g.connect(audioCtx.destination);
        osc.start(); osc.stop(audioCtx.currentTime + duration);
    }

    function resize() {
        width = window.innerWidth; height = window.innerHeight;
        canvas.width = width; canvas.height = height;
        player.y = height - 130;
    }
    window.addEventListener('resize', resize);
    resize();

    window.onmousemove = (e) => { player.x = e.clientX; };

    document.getElementById('start-btn').onclick = () => {
        document.getElementById('overlay').classList.add('hidden');
        score = 0; items = []; speed = 5; frame = 0;
        document.getElementById('score').innerText = '0';
        gameActive = true;
        update();
    };

    function spawn() {
        const r = Math.random();
        let item = { x: Math.random() * (width - 50) + 25, y: -60, rot: 0, size: 50 };
        // T·ªâ l·ªá: 70% ƒë·ªì ƒÉn, 30% qu√°i v·∫≠t
        if (r > 0.3) { 
            // List ƒë·ªì ƒÉn ng·∫´u nhi√™n
            const foods = ['üç∞', 'ü•ê', 'üçó', 'üçï', 'üå≠', 'üç£','ü•ö','üçñ'];
            item.e = foods[Math.floor(Math.random() * foods.length)];
            item.type = 'good'; 
        } else { 
            item.e = ['üë∫','ü•©']; 
            item.type = 'bad'; 
            item.size = 60; 
        }
        items.push(item);
    }

    function update() {
        if (!gameActive) return;
        ctx.clearRect(0, 0, width, height);
        frame++;

        // --- V·∫º USAGI ---
        // N·∫øu timer > 0 th√¨ v·∫Ω ·∫£nh ƒëang ƒÉn, ng∆∞·ª£c l·∫°i v·∫Ω ·∫£nh th∆∞·ªùng
        const currentImg = (isEatingTimer > 0) ? imgEating : imgNormal;
        
        if (isEatingTimer > 0) isEatingTimer--;

        // V·∫Ω ·∫£nh Usagi
        ctx.drawImage(
            currentImg, 
            player.x - player.size/2, 
            player.y - player.size/2, 
            player.size, 
            player.size
        );

        // Sinh v·∫≠t ph·∫©m
        if (frame % Math.max(15, 45 - Math.floor(score/5)) === 0) spawn();

        for (let i = items.length - 1; i >= 0; i--) {
            let o = items[i];
            o.y += speed + (score/25); // TƒÉng t·ªëc ƒë·ªô r∆°i
            o.rot += 0.03;
            
            ctx.save();
            ctx.translate(o.x, o.y);
            ctx.rotate(o.rot);
            ctx.font = o.size + 'px Arial';
            ctx.textAlign = 'center';
            ctx.textBaseline = 'middle';
            ctx.fillText(o.e, 0, 0);
            ctx.restore();

            // X·ª≠ l√Ω va ch·∫°m
            if (Math.hypot(player.x - o.x, player.y - o.y) < 60) {
                if (o.type === 'bad') {
                    // THUA CU·ªòC
                    gameActive = false;
                    playSound(150, 0.5);
                    document.getElementById('overlay').classList.remove('hidden');
                    document.body.style.cursor = 'default';
                    // L∆∞u ƒëi·ªÉm cao
                    const oldHigh = localStorage.getItem('usagi_score') || 0;
                    if(score > oldHigh) {
                        localStorage.setItem('usagi_score', score);
                        document.getElementById('high-score').innerText = score;
                    }
                } else {
                    // ƒÇN ƒêI·ªÇM
                    score += 1;
                    document.getElementById('score').innerText = score;
                    playSound(800 + Math.random()*200, 0.1); // Ti·∫øng ting ting
                    
                    // K√≠ch ho·∫°t tr·∫°ng th√°i ƒÉn trong 20 khung h√¨nh (kho·∫£ng 0.3s)
                    isEatingTimer = 20; 
                    
                    items.splice(i, 1);
                }
            } else if (o.y > height + 50) items.splice(i, 1);
        }
        requestAnimationFrame(update);
    }
    
    // Load ƒëi·ªÉm cao c≈©
    document.getElementById('high-score').innerText = localStorage.getItem('usagi_score') || 0;
</script>
</body>
</html>
